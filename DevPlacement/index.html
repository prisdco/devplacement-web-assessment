<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>DashBoard</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="../Scripts/jquery.twbsPagination.min.js"></script>
    <style>
        .searchBox {
            padding: 15px 15px 15px 60px;
            border-radius: 3px;
        }

        .center {
            display: block;
            margin-left: auto;
            margin-right: auto;
            width: 80%;
        }

        .btn {
            background-color: DodgerBlue; /* Blue background */
            border: none; /* Remove borders */
            color: white; /* White text */
            padding: 20px 30px; /* Some padding */
            font-size: 16px; /* Set a font size */
            cursor: pointer; /* Mouse pointer on hover */
        }

            /* Darker background on mouse-over */
            .btn:hover {
                background-color: RoyalBlue;
            }

        .textbox {
            width: 100%;
            padding: 12px 40px;
            margin: 8px 0;
            border-radius: 3px;
            display: inline-block;
            font-weight: 400;
            border: 1px solid #0a2742;
            color: #FFF;
            background-color: #0d2e4d;
            box-sizing: border-box;
        }

        .topsecondpanel {
            border-radius: 20px;
            background-color: #efe6e6;
            border: 1px solid #efe6e6;
            color: #1b1616
        }

        .fontuser {
            position: relative;
        }

            .fontuser i {
                position: absolute;
                left: 15px;
                top: 40px;
                color: gray;
            }
    </style>
    <script language="javascript">
                
        var $pagination = $('#pagination'),
            totalRecords = 0,
            records = [],
            displayRecords = [],
            recPerPage = 2,
            page = 1,
            pageid = 0,
            currentUser = "",
            totalPages = 0;

        $(document).ready(function () {
                       
            var response = $('#response');
            $.ajax({

                type: 'Get',
                url: 'api/users/GetUsers',
                dataType: 'json',
                success: function (data) {
                    response.empty();

                    records = data.Results;
                    totalRecords = records.length;
                    totalPages = Math.ceil(totalRecords / recPerPage);

                    response.append('<div class="row" style="padding: 10px;">'
                        + '<div class= "col-lg-12"><h3 style="font-weight:700">All Users</h3>'
                        + '<p style = "color:#808080; font-size:8pt">Filter by</p>'
                        + '</div><div class="col-lg-12"><div class="col-lg-6" style="padding:0px">'
                        + '<div class= "fontuser"><input type="text" id="Ssrch" class="textbox topsecondpanel" placeholder="Find a User">'
                        + '<i style = "top: 20px" class= "fa fa-search fa-lg"></i>'
                        + '</div></div><div class="col-lg-3">'
                        + '<select class="textbox topsecondpanel" onChange="loadusercountry()" id="country"><option>NG</option><option>US</option><option>GER</option><option>UK</option></select>'
                        + '</div>'
                        + '<div class= "col-lg-3"></div></div>'
                        + '</div>'
                        + '<div class="container-fluid responsive" id="inner" style="height: 300px; overflow-y: scroll;">'

                        + '</div>');
                    pageid = 1;
                    apply_pagination();
                }

            });

            
            $(document).on({
                ajaxStart: function () {
                    showLoading();
                },
                ajaxStop: function () {
                    hideLoading();
                }
            });

            
            $("#srch").keyup(function () {

                var srch = $("#srch").val();
                if (srch != "" && srch.toLowerCase().length > 2) {

                    GetUser(srch);

                }
                else if (srch == "") {
                    srch = "";
                    GetUser(srch);
                }
            });

            $(document).on('keyup', '#Ssrch', function (e) {
                var srch = $("#Ssrch").val();
                if (srch != "" && srch.toLowerCase().length > 2) {

                    GetUser(srch);

                }
                else if (srch == "") {
                    srch = "";
                    GetUser(srch);
                }
            });           

        });

        
        function apply_pagination() {
            
            $("#pagination").twbsPagination({
                totalPages: totalPages,
                visiblePages: 6,
                onPageClick: function (event, page) {                    
                    displayRecordsIndex = Math.max(page - 1, 0) * recPerPage;                    
                    endRec = (displayRecordsIndex) + recPerPage;
                    displayRecords = records.slice(displayRecordsIndex, endRec);
                    
                    

                        pageRec();
                    
                    
                }
            });
        }

        function Export_JSON_to_CSV(JSONString, ReportName, isShowHeader) {
            var arrJsonData = typeof JSONString != 'object' ? JSON.parse(JSONString) : JSONString;
            var CSV = '';
            CSV += ReportName + '\r\n\n';
            if (isShowHeader) {
                var row = "";
                for (var index in arrJsonData[0]) {
                    row += index + ',';
                }
                row = row.slice(0, -1);
                CSV += row + '\r\n';
            }
            for (var i = 0; i < arrJsonData.length; i++) {
                var row = "";
                for (var index in arrJsonData[i]) {
                    row += '"' + arrJsonData[i][index] + '",';
                }
                row.slice(0, row.length - 1);
                CSV += row + '\r\n';
            }
            if (CSV == '') {
                alert("Invalid JsonData");
                return;
            }
            var fileName = "CSV_";
            fileName += ReportName.replace(/ /g, "_");
            var uri = 'Data:text/csv;charset=utf-8,' + escape(CSV);
            var link = document.createElement("a");
            link.href = uri;
            link.style = "visibility:hidden";
            link.download = fileName + ".csv";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function GetUser(id) {
            var url = "";
            if (id == "" || id == null) {

                url = 'api/users/GetUsers/';
            }
            else {
                url = 'api/users/GetUser/' + id;
            }

            $.ajax({

                type: 'Get',
                url: url,
                dataType: 'json',
                success: function (data) {
                    
                    records = data.Results;
                    totalRecords = records.length;
                    totalPages = Math.ceil(totalRecords / recPerPage);
                    pageid = 2;
                    totalPages = totalPages;
                    displayRecordsIndex = Math.max(page - 1, 0) * recPerPage;
                    endRec = (displayRecordsIndex) + recPerPage;
                    displayRecords = records.slice(displayRecordsIndex, endRec);
                   
                    apply_pagination();
                    pageRec();

                }

            })

        }

        function loadusercountry() {

            var url = "";
            var srch = $("#country").val();
            if (srch == "" || srch == null) {

                url = 'api/users/GetUsers/';
            }
            else {
                url = 'api/users/GetUserCountry/' + srch;
            }

            $.ajax({

                type: 'Get',
                url: url,
                dataType: 'json',
                success: function (data) {
                    records = data.Results;
                    totalRecords = records.length;
                    totalPages = Math.ceil(totalRecords / recPerPage);
                    pageid = 2;
                    totalPages = totalPages;
                    displayRecordsIndex = Math.max(page - 1, 0) * recPerPage;
                    endRec = (displayRecordsIndex) + recPerPage;
                    displayRecords = records.slice(displayRecordsIndex, endRec);
                    
                    apply_pagination();
                    pageRec();

                }

            })


        }

        function GetAllUsers(id) {

            var url = "";
            var headerT = "";
            if (id == "" || id == null) {

                url = 'api/users/GetUsers/';
                headerT = "All Users";
            }
            else {
                url = 'api/users/GetGenderUser/' + id;
                headerT = "Users";
            }

            var response = $('#response');

            $.ajax({

                type: 'Get',
                url: url,
                dataType: 'json',
                success: function (data) {
                    response.empty();
                    response.append('<div class="row" style="padding: 10px;">'
                        + '<div class= "col-lg-12"><h3 style="font-weight:700">' + id + ' ' + headerT + '</h3>'
                        + '<p style = "color:#808080; font-size:8pt">Filter by</p>'
                        + '</div><div class="col-lg-12"><div class="col-lg-6" style="padding:0px">'
                        + '<div class= "fontuser"><input type="text" id="Ssrch" class="textbox topsecondpanel" placeholder="Find a User">'
                        + '<i style = "top: 20px" class= "fa fa-search fa-lg"></i>'
                        + '</div></div><div class="col-lg-3">'
                        + '<select class= "textbox topsecondpanel" onChange="loadusercountry()" id="country"><option>NG</option><option>US</option><option>GER</option><option>UK</option></select>'
                        + '</div>'
                        + '<div class= "col-lg-3"></div></div>'
                        + '</div>'
                        + '<div class="container-fluid responsive" id="inner" style="height: 300px; overflow-y: scroll;">'


                        + '</div>');
                    records = data.Results;
                    totalRecords = records.length;
                    totalPages = Math.ceil(totalRecords / recPerPage);
                    pageid = 2;
                    totalPages = totalPages;
                    displayRecordsIndex = Math.max(page - 1, 0) * recPerPage;
                    endRec = (displayRecordsIndex) + recPerPage;
                    displayRecords = records.slice(displayRecordsIndex, endRec);
                   
                    apply_pagination();
                    pageRec();
                }

            })


        }

        function pageRec() {

            var inner = $('#inner');
            inner.empty();
            for (var i = 0; i < displayRecords.length; i++) {

                inner.append('<div class="row" id="page" style=" background-color: #FFFFFF">'
                    + '<div class="col-lg-3" style="padding:5px;">'
                    + '<img src="' + displayRecords[i].pic.medium + '" height="100" width="120" alt="Paris" class="center" style="border-radius:50%; border:5px solid #68d1a3" />'
                    + '</div>'
                    + '<div class="col-lg-9">'
                    + '<p><h3 style="font-weight:700; font-size:14pt">' + displayRecords[i].name.first + ' ' + displayRecords[i].name.last + '</h3></p>'
                    + '<p><h5 style="font-family: tahoma; font-style:italic; color: #a09b9b;">' + displayRecords[i].location.street.number + ' ' + displayRecords[i].location.street.name + ', ' + displayRecords[i].location.city + ', ' + displayRecords[i].location.state + '</h5></p>'
                    + '<div class="row" style="margin-right:1%; color: #a9a9a9;">'
                    + '<span style="float:left; padding: 8px 15px"><i class="fa fa-envelope"></i>&nbsp;&nbsp;' + displayRecords[i].email + '</span> &nbsp;&nbsp; <span style="float:left;  padding: 8px 15px"><i class="fa fa-phone"></i>&nbsp;&nbsp;' + displayRecords[i].phone + '</span> &nbsp;&nbsp;'
                    + '<span style="float:right;">'
                    + '<button onclick="GetUser(' + displayRecords[i].userID + ')" class="btn" style="background-color: #68d1a3;border-radius:8px; padding: 8px 15px"><i class="fa fa-arrow-right" aria-hidden="true"></i></button>'
                    + '</span>'
                    + '</div>'
                    + '</div>'
                    + '</div>'
                    + '<br />'
                );
            }
        }

        $(function () {

            $("#allusers").click(function () {
                showLoading();
                GetAllUsers("");
                hideLoading();
            });

            $("#maleusers").click(function () {
                showLoading();
                GetAllUsers("Male");
                hideLoading();
            });

            $("#femaleusers").click(function () {
                showLoading();
                GetAllUsers("Female");
                hideLoading();
            });

            $("#export").click(function () {
                var JsonData = displayRecords;
                var ReportName = "csvdata";
                if (ReportName == '') {
                    alert("Please Enter Report Name.");
                    return;
                }
                if (JsonData == '') {
                    alert("Empty JSON string not allow.");
                    return;
                }

                Export_JSON_to_CSV(JsonData, ReportName, true);
            });


        })

        function showLoading() {
            var loading = $("#loading");
            loading

                .css({ visibility: "visible" })

                .css({ opacity: "1" })

                .css({ display: "block" })

                ;

        }

        //hide loading bar

        function hideLoading() {
            var loading = $("#loading");
            loading.fadeTo(1000, 0);
            loading

                .css({ display: "none" })

        };

        $(document).on({
            ajaxStart: function () {
                showLoading();
            },
            ajaxStop: function () {
                hideLoading();
            }
        });


    </script>
</head>
<body style="background-color: #111">
    <div class="container" style="width: 80%; margin-top: 4%; background-color: #0a2742">
        <div class="row">

            <div class="col-sm-6" style="height: 500px; background-color:#0a2742">
                <div class="row" style=" margin: 10%;padding: 10px;">
                    <h2 style="color: #efe6e6; ">Hello, </h2>
                    <p style="color: #efe6e6;">Welcome to your dashboard. Kindly sort through user base</p>

                    <div class="fontuser">
                        <input type="text" id="srch" class="textbox" placeholder="Find a User" name="uname">
                        <i style="top: 20px" class="fa fa-search fa-lg"></i>
                    </div>

                    <div class="row">
                        <h4 style="color: #FFFFFF; font-weight:700">Show Users</h4>
                    </div>
                    <div class="row">
                        <div class="col-lg-4" style="">
                            <button id="allusers" class="btn" style="background-color: #cc3978"><i class="fa fa-users fa-2x"></i></button>
                            <h5 style="color:#efe6e6; margin-left:15%; font-weight:700; font-size:8pt">All Users</h5>
                        </div>
                        <div class="col-lg-4">
                            <button id="maleusers" class="btn" style="background-color: #68d1a3"><i class="fa fa-male fa-2x"></i></button>
                            <h5 style="color:#efe6e6; margin-left:10%; font-weight:700; font-size:8pt">Male Users</h5>
                        </div>
                        <div class="col-lg-4">
                            <button id="femaleusers" class="btn" style="background-color: #3f56c1"><i class="fa fa-female fa-2x"></i></button>
                            <h5 style="color:#efe6e6; margin-left:5%; font-weight:700; font-size:8pt">Female Users</h5>
                        </div>
                    </div>

                </div>
            </div>
            <div class="col-sm-6" style="background-color: #f8f8f8; border-radius: 5px; padding: 20px; height: auto; overflow:hidden ">
                <div id="loading">
                    <img src="images/loading.gif" alt="Loading..." width="60" height="60" />
                </div>
                <div id="response"></div>
                <div id="pager">
                    <ul id="pagination" class="pagination-sm"></ul>
                </div>
                <button id="export" class="btn" style="background-color: #17a969">Export Data</button>
            </div>    
            
        </div>

    </div>
</body>
</html>